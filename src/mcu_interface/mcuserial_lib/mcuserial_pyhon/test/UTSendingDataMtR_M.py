import serial
import time

Client = serial.Serial("/dev/serial0", 115200)

def print_hexstr(data, first_string=''):
    result = bytearray()
    for i in data:
        result.extend(i)
    string = first_string
    for b in result:
        string = string + str(hex(b)) + ' '
    print(string)

#start len seqnum_function regnum listoff listcount data crc

# TEST NOISE ON LINE
print("Test noise on line")
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x03\x9a\x19@C\xfe\x5a')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'0000w\x08\x0b\x03\x9a\x19@C\xfe\x5a0000')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x03\x9a\x19@C\xfe\x5a0000')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'0000w\x08\x0b\x03\x9a\x19@C\xfe\x5a')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'00w\x04\x0100000000000000w\x08\x0b\x03\x9a\x19@C\xfe\x5a0000')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out1 = bytearray(b'w\x08\x0b\x03\x9a')
out2 = bytearray(b'\x19@C\xfe\x5a')
Client.write(out1)
Client.write(out2)
inn = Client.read(6)
print_hexstr(inn)
out1 = bytearray(b'w\x08\x0b\x03\x9a')
out2 = bytearray(b'\x19@C\xfe\x5a')
Client.write(out1)
time.sleep(0.5)
Client.write(out2)
inn = Client.read(6)
print_hexstr(inn)
inn = Client.read(6)
print_hexstr(inn)


# TEST BAD CRC
print("Test bad crc")
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x03\x9a\x19@C\xfe\x5b')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x03\x9a\x19@C\xfe\x5b')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x03\x9a\x19@C\xfe\x5b')
Client.write(out)

# TEST MISSING DATA, TEST NOT 4 BYTES DATA
print("Test missing data")
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x04\x0b\x03\xa7\xc1')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x04\x0b\x03\xa7\xc1')
Client.write(out)
inn = Client.read(6)
print_hexstr(inn)
out = bytearray(b'w\x04\x0b\x03\xa7\xc1')
Client.write(out)

inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x0a\x0b\x50\x00\x01\x01\x00\x00\x00\x2d\x07')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x07\x0b\x50\x00\x01\x01\x1e\x7e')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x07\x0b\x50\x00\x01\x01\x1e\x7e')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x07\x0b\x50\x00\x01\x01\x1e\x7e')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x05\x0b\x50\x01\x39\x74')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x05\x0b\x50\x01\x39\x74')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x05\x0b\x50\x01\x39\x74')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x50\x01\x00\x00\x00\x75\xa3')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x50\x01\x00\x00\x00\x75\xa3')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x08\x0b\x50\x01\x00\x00\x00\x75\xa3')
Client.write(out)


# TEST INEXISTING FUNCTION
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x0a\x0a\x50\x00\x01\x01\x00\x00\x00\x6a\xd4')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x0a\x0a\x50\x00\x01\x01\x00\x00\x00\x6a\xd4')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x0a\x0a\x50\x00\x01\x01\x00\x00\x00\x6a\xd4')
Client.write(out)
inn = Client.read(8)
print_hexstr(inn)
out = bytearray(b'w\x0a\x0b\x51\x00\x01\x01\x00\x00\x00\x95\x66')
Client.write(out)

